name: Combine CSS files

# mainブランチにプッシュされた時にこのアクションを実行
on:
  push:
    branches:
      - main
  # 手動でも実行できるようにする
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      # 1. リポジトリのコードをチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. CSSファイルを結合する
      - name: Combine CSS files
        run: |
          # dist.cssを初期化し、自動生成である旨のコメントを先頭に追記
          echo "/* This file is auto-generated by a GitHub Action. Do not edit directly. */" > dist.css
          # dist.css以外の全ての.cssファイルを探し、その内容をdist.cssに追記
          find . -type f -name "*.css" ! -name "dist.css" -exec cat {} + >> dist.css

      # 3. 変更があった場合のみ自動でコミット＆プッシュ
      - name: Commit and push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: Auto-generate dist.css"
          file_pattern: dist.css
